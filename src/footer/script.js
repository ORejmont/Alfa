const translations = {
  cs: {
    cart: {
      title: (count) => `V√°≈° ko≈°√≠k (${count})`,
      empty: "V√°≈° ko≈°√≠k je moment√°lnƒõ pr√°zdn√Ω.",
      total: "Celkem",
      suggest: "Zkuste si prohl√©dnout tyto kategorie:",
      continue: "Pokraƒçovat v n√°kupu",
    },
    search: {
      categories: "Nalezen√© kategorie",
      others: "Ostatn√≠ v√Ωsledky",
    },
    topCategories: "Top kategorie",
    footer: {
      createdBy:
        '≈†ablonu vytvo≈ôil <a href="https://www.rejmedia.com/" target="_blank" rel="noopener noreferrer">REJ Media</a>',
    },
  },
  sk: {
    cart: {
      title: (count) => `V√°≈° ko≈°√≠k (${count})`,
      empty: "V√°≈° ko≈°√≠k je moment√°lne pr√°zdny.",
      total: "Celkom",
      suggest: "Sk√∫ste si pozrie≈• tieto kateg√≥rie:",
      continue: "Pokraƒçova≈• v n√°kupe",
    },
    search: {
      categories: "N√°jden√© kateg√≥rie",
      others: "Ostatn√© v√Ωsledky",
    },
    topCategories: "Top kateg√≥rie",
    footer: {
      createdBy:
        '≈†abl√≥nu vytvorila <a href="https://www.rejmedia.com/" target="_blank" rel="noopener noreferrer">REJ Media</a>',
    },
  },
  pl: {
    cart: {
      title: (count) => `Tw√≥j koszyk (${count})`,
      empty: "Tw√≥j koszyk jest obecnie pusty.",
      total: "Razem",
      suggest: "Zobacz te kategorie:",
      continue: "Kontynuuj zakupy",
    },
    search: {
      categories: "Znalezione kategorie",
      others: "Inne wyniki",
    },
    topCategories: "Najlepsze kategorie",
    footer: {
      createdBy:
        'Szablonƒô stworzy≈Ço <a href="https://www.rejmedia.com/" target="_blank" rel="noopener noreferrer">REJ Media</a>',
    },
  },
  de: {
    cart: {
      title: (count) => `Ihr Warenkorb (${count})`,
      empty: "Ihr Warenkorb ist momentan leer.",
      total: "Gesamt",
      suggest: "Sehen Sie sich diese Kategorien an:",
      continue: "Weiter einkaufen",
    },
    search: {
      categories: "Gefundene Kategorien",
      others: "Andere Ergebnisse",
    },
    topCategories: "Top-Kategorien",
    footer: {
      createdBy:
        'Vorlage erstellt von <a href="https://www.rejmedia.com/" target="_blank" rel="noopener noreferrer">REJ Media</a>',
    },
  },
  en: {
    cart: {
      title: (count) => `Your cart (${count})`,
      empty: "Your cart is currently empty.",
      total: "Total",
      suggest: "Check out these categories:",
      continue: "Continue shopping",
    },
    search: {
      categories: "Found categories",
      others: "Other results",
    },
    topCategories: "Top categories",
    footer: {
      createdBy:
        'Template created by <a href="https://www.rejmedia.com/" target="_blank" rel="noopener noreferrer">REJ Media</a>',
    },
  },
  hu: {
    cart: {
      title: (count) => `Kosarad (${count})`,
      empty: "A kosarad jelenleg √ºres.",
      total: "√ñsszesen",
      suggest: "N√©zd meg ezeket a kateg√≥ri√°kat:",
      continue: "Folytassa a v√°s√°rl√°st",
    },
    search: {
      categories: "Tal√°lt kateg√≥ri√°k",
      others: "Egy√©b tal√°latok",
    },
    topCategories: "Top kateg√≥ri√°k",
    footer: {
      createdBy:
        'A sablont k√©sz√≠tette <a href="https://www.rejmedia.com/" target="_blank" rel="noopener noreferrer">REJ Media</a>',
    },
  },
  ro: {
    cart: {
      title: (count) => `Co»ôul tƒÉu (${count})`,
      empty: "Co»ôul tƒÉu este momentan gol.",
      total: "Total",
      suggest: "Vezi aceste categorii:",
      continue: "ContinuƒÉ cumpƒÉrƒÉturile",
    },
    search: {
      categories: "Categorii gƒÉsite",
      others: "Alte rezultate",
    },
    topCategories: "Categorii de top",
    footer: {
      createdBy:
        '»òablon creat de <a href="https://www.rejmedia.com/" target="_blank" rel="noopener noreferrer">REJ Media</a>',
    },
  },
  si: {
    cart: {
      title: (count) => `Va≈°a ko≈°arica (${count})`,
      empty: "Va≈°a ko≈°arica je trenutno prazna.",
      total: "Skupaj",
      suggest: "Oglejte si te kategorije:",
      continue: "Nadaljujte z nakupovanjem",
    },
    search: {
      categories: "Najdene kategorije",
      others: "Drugi rezultati",
    },
    topCategories: "Top kategorije",
    footer: {
      createdBy:
        'Predlogo je ustvaril <a href="https://www.rejmedia.com/" target="_blank" rel="noopener noreferrer">REJ Media</a>',
    },
  },
  hr: {
    cart: {
      title: (count) => `Va≈°a ko≈°arica (${count})`,
      empty: "Va≈°a ko≈°arica je trenutno prazna.",
      total: "Ukupno",
      suggest: "Pogledajte ove kategorije:",
      continue: "Nastavite kupovinu",
    },
    search: {
      categories: "Pronaƒëene kategorije",
      others: "Ostali rezultati",
    },
    topCategories: "Top kategorije",
    footer: {
      createdBy:
        'Predlo≈æak izradio <a href="https://www.rejmedia.com/" target="_blank" rel="noopener noreferrer">REJ Media</a>',
    },
  },
  bg: {
    cart: {
      title: (count) => `–í–∞—à–∞—Ç–∞ –∫–æ–ª–∏—á–∫–∞ (${count})`,
      empty: "–í–∞—à–∞—Ç–∞ –∫–æ–ª–∏—á–∫–∞ –≤ –º–æ–º–µ–Ω—Ç–∞ –µ –ø—Ä–∞–∑–Ω–∞.",
      total: "–û–±—â–æ",
      suggest: "–í–∏–∂—Ç–µ —Ç–µ–∑–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:",
      continue: "–ü—Ä–æ–¥—ä–ª–∂–µ—Ç–µ —Å –ø–∞–∑–∞—Ä—É–≤–∞–Ω–µ—Ç–æ",
    },
    search: {
      categories: "–ù–∞–º–µ—Ä–µ–Ω–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏",
      others: "–î—Ä—É–≥–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏",
    },
    topCategories: "–¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏",
    footer: {
      createdBy:
        '–®–∞–±–ª–æ–Ω—ä—Ç –µ —Å—ä–∑–¥–∞–¥–µ–Ω –æ—Ç <a href="https://www.rejmedia.com/" target="_blank" rel="noopener noreferrer">REJ Media</a>',
    },
  },
  el: {
    cart: {
      title: (count) => `Œ§Œø Œ∫Œ±ŒªŒ¨Œ∏Œπ œÉŒ±œÇ (${count})`,
      empty: "Œ§Œø Œ∫Œ±ŒªŒ¨Œ∏Œπ œÉŒ±œÇ ŒµŒØŒΩŒ±Œπ œÄœÅŒøœÇ œÑŒø œÄŒ±œÅœåŒΩ Œ¨Œ¥ŒµŒπŒø.",
      total: "Œ£œçŒΩŒøŒªŒø",
      suggest: "ŒîŒµŒØœÑŒµ Œ±œÖœÑŒ≠œÇ œÑŒπœÇ Œ∫Œ±œÑŒ∑Œ≥ŒøœÅŒØŒµœÇ:",
      continue: "Œ£œÖŒΩŒµœáŒØœÉœÑŒµ œÑŒπœÇ Œ±Œ≥ŒøœÅŒ≠œÇ",
    },
    search: {
      categories: "ŒíœÅŒ≠Œ∏Œ∑Œ∫Œ±ŒΩ Œ∫Œ±œÑŒ∑Œ≥ŒøœÅŒØŒµœÇ",
      others: "ŒÜŒªŒªŒ± Œ±œÄŒøœÑŒµŒªŒ≠œÉŒºŒ±œÑŒ±",
    },
    topCategories: "ŒöŒøœÅœÖœÜŒ±ŒØŒµœÇ Œ∫Œ±œÑŒ∑Œ≥ŒøœÅŒØŒµœÇ",
    footer: {
      createdBy:
        'Œ§Œø œÄœÅœåœÑœÖœÄŒø Œ¥Œ∑ŒºŒπŒøœÖœÅŒ≥ŒÆŒ∏Œ∑Œ∫Œµ Œ±œÄœå œÑŒ∑ŒΩ <a href="https://www.rejmedia.com/" target="_blank" rel="noopener noreferrer">REJ Media</a>',
    },
  },
  it: {
    cart: {
      title: (count) => `Il tuo carrello (${count})`,
      empty: "Il tuo carrello √® attualmente vuoto.",
      total: "Totale",
      suggest: "Dai un'occhiata a queste categorie:",
      continue: "Continua lo shopping",
    },
    search: {
      categories: "Categorie trovate",
      others: "Altri risultati",
    },
    topCategories: "Categorie top",
    footer: {
      createdBy:
        'Modello creato da <a href="https://www.rejmedia.com/" target="_blank" rel="noopener noreferrer">REJ Media</a>',
    },
  },
  lt: {
    cart: {
      title: (count) => `J≈´s≈≥ krep≈°elis (${count})`,
      empty: "J≈´s≈≥ krep≈°elis ≈°iuo metu tu≈°ƒçias.",
      total: "I≈° viso",
      suggest: "Per≈æi≈´rƒókite ≈°ias kategorijas:",
      continue: "Tƒôsti apsipirkimƒÖ",
    },
    search: {
      categories: "Rastos kategorijos",
      others: "Kiti rezultatai",
    },
    topCategories: "Populiariausios kategorijos",
    footer: {
      createdBy:
        '≈†ablonƒÖ suk≈´rƒó <a href="https://www.rejmedia.com/" target="_blank" rel="noopener noreferrer">REJ Media</a>',
    },
  },
  vi: {
    cart: {
      title: (count) => `Gi·ªè h√†ng c·ªßa b·∫°n (${count})`,
      empty: "Gi·ªè h√†ng c·ªßa b·∫°n hi·ªán ƒëang tr·ªëng.",
      total: "T·ªïng c·ªông",
      suggest: "H√£y xem c√°c danh m·ª•c n√†y:",
      continue: "Ti·∫øp t·ª•c mua s·∫Øm",
    },
    search: {
      categories: "Danh m·ª•c ƒë∆∞·ª£c t√¨m th·∫•y",
      others: "K·∫øt qu·∫£ kh√°c",
    },
    topCategories: "Danh m·ª•c h√†ng ƒë·∫ßu",
    footer: {
      createdBy:
        'M·∫´u ƒë∆∞·ª£c t·∫°o b·ªüi <a href="https://www.rejmedia.com/" target="_blank" rel="noopener noreferrer">REJ Media</a>',
    },
  },
  other: {
    cart: {
      title: (count) => `Your cart (${count})`,
      empty: "Your cart is currently empty.",
      total: "Total",
      suggest: "Check out these categories:",
      continue: "Continue shopping",
    },
    search: {
      categories: "Found categories",
      others: "Other results",
    },
    topCategories: "Top categories",
    footer: {
      createdBy:
        'Template created by <a href="https://www.rejmedia.com/" target="_blank" rel="noopener noreferrer">REJ Media</a>',
    },
  },
};
// P≈ôeklady pro v≈°echny jazyky

document.body.classList.add("rej-media-alfa");

/* Signature */
document.addEventListener("DOMContentLoaded", () => {
  const lang = document.documentElement.lang || "en";
  const translation =
    translations[lang]?.footer?.createdBy ||
    translations["other"].footer.createdBy;

  const signature = document.querySelector("#signature");
  if (signature) {
    const div = document.createElement("div");
    div.classList.add("signature-rejmedia");
    div.innerHTML = translation;
    signature.insertAdjacentElement("afterend", div);
  }
});
/* Signature */

/* Custom scroll a hover classy */
document.addEventListener("DOMContentLoaded", () => {
  const header = document.getElementById("header");
  const html = document.documentElement;
  let hoverCleanup = null;
  let scrollHandlerActive = false;

  /* -------------------------
     SCROLLED-CUSTOM podle scrollu
  ------------------------- */
  function checkHeader() {
    if (!header) return;

    const scrollTop = window.scrollY || document.documentElement.scrollTop;
    const headerOffsetTop = header.offsetTop;

    if (scrollTop >= headerOffsetTop) {
      html.classList.add("scrolled-custom");
    } else {
      html.classList.remove("scrolled-custom");
    }
  }

  /* -------------------------
     HEADER-HOVER t≈ô√≠da
  ------------------------- */
  function handleHeaderHover() {
    if (!header) return () => {};

    // const extraButtons = document.querySelectorAll(
    //   ".top-navigation-bar .container .top-navigation-tools .top-nav-button-login, " +
    //     ".top-navigation-bar .container .top-navigation-tools .top-nav-button-account"
    // );

    const addClass = () => document.body.classList.add("header-hover");
    const removeClass = () => document.body.classList.remove("header-hover");

    header.addEventListener("mouseenter", addClass);
    header.addEventListener("mouseleave", removeClass);

    // extraButtons.forEach((btn) => {
    //   btn.addEventListener("mouseenter", addClass);
    //   btn.addEventListener("mouseleave", removeClass);
    // });

    return () => {
      header.removeEventListener("mouseenter", addClass);
      header.removeEventListener("mouseleave", removeClass);
      // extraButtons.forEach((btn) => {
      //   btn.removeEventListener("mouseenter", addClass);
      //   btn.removeEventListener("mouseleave", removeClass);
      // });
      document.body.classList.remove("header-hover");
    };
  }

  /* -------------------------
     Aktivace / deaktivace podle ≈°√≠≈ôky
  ------------------------- */
  function enable() {
    if (!scrollHandlerActive) {
      checkHeader();
      window.addEventListener("scroll", checkHeader, { passive: true });
      scrollHandlerActive = true;
    }
    if (!hoverCleanup) {
      hoverCleanup = handleHeaderHover();
    }
  }

  function disable() {
    if (scrollHandlerActive) {
      window.removeEventListener("scroll", checkHeader);
      html.classList.remove("scrolled-custom");
      scrollHandlerActive = false;
    }
    if (hoverCleanup) {
      hoverCleanup();
      hoverCleanup = null;
    }
  }

  function handleResponsiveInit() {
    if (window.innerWidth >= 768) {
      enable();
    } else {
      disable();
    }
  }

  /* -------------------------
     Inicializace
  ------------------------- */
  handleResponsiveInit();
  window.addEventListener("resize", handleResponsiveInit);
});
/* Custom scroll a hover classy */

/* P≈ôesunut√≠ account ikony */
function moveLoginAccountButton() {
  // Bƒõ≈æ√≠ jen na 768px a v√≠c
  if (window.innerWidth < 768) return;

  const navigationButtons = document.querySelector(".navigation-buttons");

  if (!navigationButtons) return;

  // Login nebo Account ‚Äì bereme ten, kter√Ω existuje
  const loginBtn = document.querySelector(
    ".top-navigation-bar .container .top-navigation-tools .top-nav-button-login"
  );
  const accountBtn = document.querySelector(
    ".top-navigation-bar .container .top-navigation-tools .top-nav-button-account"
  );

  const buttonToMove = loginBtn || accountBtn;
  if (!buttonToMove) return;

  // P≈ôesu≈à button na zaƒç√°tek (.prepend)
  navigationButtons.prepend(buttonToMove);
}

// Spust√≠me p≈ôi naƒçten√≠
document.addEventListener("DOMContentLoaded", moveLoginAccountButton);

// A tak√© p≈ôi resize (kdyby user zmƒõnil velikost)
window.addEventListener("resize", () => {
  moveLoginAccountButton();
});
/* P≈ôesunut√≠ account ikony */

/* Hide site-msg */
(function handleSiteMsgVisibility() {
  const siteMsg = document.querySelector(".site-msg");
  const container = siteMsg?.querySelector(".container");
  const textEl = container?.querySelector(".text");
  const toggleKey = "siteMsgVisible";
  const textKey = "siteMsgText";

  if (!siteMsg || !container || !textEl) return;

  // P≈ôid√°n√≠ tlaƒç√≠tka pro zav≈ôen√≠, pokud tam nen√≠
  let hideBtn = container.querySelector(".site-msg-hide");
  if (!hideBtn) {
    hideBtn = document.createElement("div");
    hideBtn.className = "site-msg-hide";
    container.appendChild(hideBtn);
  }

  const currentText = textEl.textContent.trim();
  const savedText = localStorage.getItem(textKey);
  const wasVisible = localStorage.getItem(toggleKey);

  // Rozhodnut√≠, zda zobrazit zpr√°vu
  if (savedText !== currentText) {
    siteMsg.classList.add("site-msg-visible");
    localStorage.setItem(textKey, currentText);
    localStorage.setItem(toggleKey, "true");
  } else if (wasVisible === "true" || wasVisible === null) {
    siteMsg.classList.add("site-msg-visible");
  } else {
    siteMsg.classList.remove("site-msg-visible");
  }

  // Kliknut√≠ na zav√≠rac√≠ tlaƒç√≠tko
  hideBtn.addEventListener("click", () => {
    const isNowVisible = siteMsg.classList.toggle("site-msg-visible");
    localStorage.setItem(toggleKey, isNowVisible.toString());
  });
})();
/* Hide site-msg */

/* Get top categories */
function getTopCategoriesData(slugs) {
  const menuItems = Array.from(
    document.querySelectorAll("#navigation a[data-testid='headerMenuItem']")
  );

  return slugs
    .map((slug) => {
      const item = menuItems.find(
        (a) =>
          a.href.includes(`/${slug}/`) ||
          a.getAttribute("href").includes(`/${slug}/`)
      );
      if (!item) return null;

      const parentLi = item.closest("li");

      let imgEl;
      const imgs = parentLi?.querySelectorAll("a.menu-image img") || [];
      for (let img of imgs) {
        const parentA = img.closest("a");
        if (
          parentA &&
          parentA.getAttribute("href") === item.getAttribute("href")
        ) {
          imgEl = img;
          break;
        }
      }

      const imageSrc =
        imgEl?.dataset.src ||
        imgEl?.src ||
        "https://cdn.myshoptet.com/prj/dist/master/cms/templates/frontend_templates/00/img/folder.svg";

      const nameEl =
        parentLi?.querySelector("b") || parentLi?.querySelector("span") || item;
      const name = nameEl?.textContent.trim() || slug;

      return {
        href: item.getAttribute("href"),
        name,
        image: imageSrc,
      };
    })
    .filter(Boolean);
}
/* Get top categories */

/* Otev√≠r√°n√≠ ko≈°√≠ku */
function handleCartWindowOpen() {
  const cartCountButton = document.querySelector(".cart-count");
  const cartWidget = document.querySelector("#cart-widget");

  if (!cartCountButton || !cartWidget) return;

  // P≈ôid√°me classu pro p≈ôedbƒõ≈æn√© zablokov√°n√≠ kliknut√≠
  cartCountButton.classList.add("custom-open");

  function updateCartTitle() {
    const lang = document.documentElement.lang || "other";
    const dict = translations[lang] || translations.other;

    const itemCountEl = document.querySelector(".cart-count i");
    const itemCount = itemCountEl ? itemCountEl.textContent.trim() : "0";

    // Odebrat star√Ω title + empty + total + price-range
    const existingTitle = cartWidget.querySelector(".cart-window-title");
    if (existingTitle) existingTitle.remove();
    const existingEmpty = cartWidget.querySelector(
      ".cart-window-empty-content"
    );
    if (existingEmpty) existingEmpty.remove();
    const existingTotal = cartWidget.querySelector(".cart-window-total");
    if (existingTotal) existingTotal.remove();
    const existingRange = cartWidget.querySelector(".price-range");
    if (existingRange) existingRange.remove();

    // Nov√Ω title
    const titleHTML = document.createElement("div");
    titleHTML.className = "cart-window-title";
    titleHTML.innerHTML = `
      <h4>${dict.cart.title(itemCount)}</h4>
      <div class="cart-window-close"></div>
    `;
    cartWidget.prepend(titleHTML);

    // Listener na zav≈ôen√≠
    const closeBtn = titleHTML.querySelector(".cart-window-close");
    if (closeBtn) {
      ["click", "touchstart"].forEach((evt) =>
        closeBtn.addEventListener(evt, (event) => {
          document.body.classList.remove("cart-window-visible-custom");
        })
      );
    }

    // Nejd≈ô√≠v v≈ædy sma≈æ p≈ô√≠padn√© star√© bloky
    cartWidget
      .querySelectorAll(
        ".cart-window-empty-content, .cart-suggested-categories"
      )
      .forEach((el) => el.remove());

    // Pokud nen√≠ ko≈°√≠k pln√Ω ‚Üí zobraz√≠me "empty"
    if (!cartCountButton.classList.contains("full")) {
      cartWidget.classList.add("cart-empty-custom");

      // ochrana proti duplicitƒõ
      if (!cartWidget.querySelector(".cart-window-empty-content")) {
        const emptyHTML = document.createElement("div");
        emptyHTML.className = "cart-window-empty-content";
        emptyHTML.textContent = dict.cart.empty;
        cartWidget.insertBefore(emptyHTML, titleHTML.nextSibling);

        // P≈ôid√°me top kategorie jen pokud existuj√≠
        if (
          typeof topCategories !== "undefined" &&
          Array.isArray(topCategories) &&
          topCategories.length
        ) {
          const topCatsData = getTopCategoriesData(topCategories);

          const suggestWrap = document.createElement("div");
          suggestWrap.className = "cart-suggested-categories";
          suggestWrap.innerHTML = `
            <span>${dict.cart.suggest}</span>
            <div class="top-categories-wrapper-cart"></div>
          `;
          const wrapper = suggestWrap.querySelector(
            ".top-categories-wrapper-cart"
          );

          topCatsData.forEach((cat) => {
            // pokud m√° image thumb ‚Üí nahraƒè na orig
            let imageSrc = cat.image;
            if (imageSrc.includes("/thumb/")) {
              imageSrc = imageSrc.replace("/thumb/", "/orig/");
            }

            wrapper.innerHTML += `
              <a href="${cat.href}" class="top-category-item-cart">
                <img src="${imageSrc}" alt="${cat.name}" />
                <p>${cat.name}</p>
              </a>
            `;
          });

          cartWidget.insertBefore(suggestWrap, emptyHTML.nextSibling);
        }

        // P≈ôidat tlaƒç√≠tko "Pokraƒçovat v n√°kupu"
        if (!cartWidget.querySelector(".cart-continue-shopping")) {
          const continueBtn = document.createElement("button");
          continueBtn.type = "button";
          continueBtn.className = "cart-continue-shopping";
          continueBtn.textContent = dict.cart.continue;

          ["click", "touchstart"].forEach((evt) =>
            continueBtn.addEventListener(evt, () => {
              document.body.classList.remove("cart-window-visible-custom");
            })
          );

          const continueOrderButton = cartWidget.querySelector(
            "#continue-order-button"
          );
          if (continueOrderButton) {
            continueOrderButton.parentNode.insertBefore(
              continueBtn,
              continueOrderButton
            );
          }
        }
      }
    } else {
      cartWidget.classList.remove("cart-empty-custom");

      // odstranit star√© elementy, pokud ko≈°√≠k nen√≠ pr√°zdn√Ω
      const emptyHTML = cartWidget.querySelector(".cart-window-empty-content");
      if (emptyHTML) emptyHTML.remove();

      const suggestWrap = cartWidget.querySelector(
        ".cart-suggested-categories"
      );
      if (suggestWrap) suggestWrap.remove();

      const continueBtn = cartWidget.querySelector(".cart-continue-shopping");
      if (continueBtn) continueBtn.remove();
    }

    // Spoƒç√≠tat celkovou cenu
    const priceEls = cartWidget.querySelectorAll(
      ".cart-widget-product span[data-testid='cartWidgetProductPrice']"
    );

    let total = 0;
    let currency = "";
    let decimalSeparator = ".";
    let hasDecimals = false;

    if (priceEls.length > 0) {
      priceEls.forEach((el, idx) => {
        const text = el.textContent.trim();

        // Urƒç√≠m oddƒõlovaƒç podle prvn√≠ho nalezen√©ho desetinn√©ho z√°pisu
        if (idx === 0) {
          if (text.match(/\d+,\d{1,2}/)) {
            decimalSeparator = ",";
          } else if (text.match(/\d+\.\d{1,2}/)) {
            decimalSeparator = ".";
          }
        }

        // Konverze ƒç√≠sla (pro v√Ωpoƒçet v≈ædy teƒçka)
        const number = parseFloat(
          text.replace(/[^\d,.-]/g, "").replace(",", ".")
        );

        if (!isNaN(number)) {
          total += number;
          if (number % 1 !== 0) {
            hasDecimals = true;
          }
          if (!currency && idx === 0) {
            // Detekce mƒõny
            currency = text.replace(/[\d\s.,-]/g, "").trim();
            if (!currency) {
              // fallback kdy≈æ mƒõna je p≈ôed ƒç√≠slem (nap≈ô. z≈Ç562,80)
              currency = text.match(/[^\d\s.,-]+/g)?.[0] || "";
            }
          }
        }
      });

      // Form√°tov√°n√≠ v√Ωsledku
      let formattedTotal;
      if (hasDecimals) {
        formattedTotal = total.toFixed(2);
      } else {
        formattedTotal = total.toFixed(0);
      }
      if (decimalSeparator === ",") {
        formattedTotal = formattedTotal.replace(".", ",");
      }

      const totalHTML = document.createElement("div");
      totalHTML.className = "cart-window-total";
      totalHTML.innerHTML = `
        <strong>${dict.cart.total}:</strong> ${formattedTotal} ${currency}
      `;
      const cartButton = cartWidget.querySelector(".cart-widget-button");
      if (cartButton) {
        cartWidget.insertBefore(totalHTML, cartButton);
      }
    }

    // P≈ôidat progress bar k free shipping
    const freeShippingEl = cartWidget.querySelector(
      ".cart-free-shipping strong"
    );
    if (freeShippingEl) {
      const freeContainer = cartWidget.querySelector(".cart-free-shipping");
      const freeText = freeShippingEl.textContent.trim();
      const remaining = parseFloat(
        freeText.replace(/[^\d,.-]/g, "").replace(",", ".")
      );

      if (!isNaN(remaining) && total > 0) {
        // Pokud je tam ƒç√°stka ‚Üí uk√°≈æeme progress bar
        const goal = total + remaining;
        const progress = Math.min(100, (total / goal) * 100);

        const range = document.createElement("div");
        range.className = "price-range";
        range.innerHTML = `<div style="width: ${progress.toFixed(0)}%"></div>`;
        freeContainer.appendChild(range);

        // Nen√≠ free, tak≈æe classu nep≈ôid√°v√°me
        freeContainer.classList.remove("free");
      } else {
        // ≈Ω√°dn√° ƒç√°stka ‚Üí doprava zdarma, p≈ôid√°me classu
        freeContainer.classList.add("free");
      }
    }
  }

  // Otev≈ôen√≠ ko≈°√≠ku
  ["click", "touchstart"].forEach((evt) =>
    cartCountButton.addEventListener(evt, (event) => {
      event.preventDefault();
      const isVisible = document.body.classList.contains(
        "cart-window-visible-custom"
      );
      if (isVisible) {
        document.body.classList.remove("cart-window-visible-custom");
      } else {
        document.body.classList.add("cart-window-visible-custom");
        updateCartTitle();
      }
    })
  );

  // Zav≈ôen√≠ kliknut√≠m mimo ko≈°√≠k
  ["click", "touchstart"].forEach((evt) =>
    document.addEventListener(evt, (event) => {
      const isInsideCart = cartWidget.contains(event.target);
      const isCartCount = cartCountButton.contains(event.target);
      if (!isInsideCart && !isCartCount) {
        document.body.classList.remove("cart-window-visible-custom");
      }
    })
  );

  // Reaguj na Shoptet zmƒõny
  document.addEventListener("ShoptetDOMContentLoaded", () => {
    if (document.body.classList.contains("cart-window-visible-custom")) {
      updateCartTitle();
    }
  });
}

document.addEventListener("DOMContentLoaded", handleCartWindowOpen);
/* Otev√≠r√°n√≠ ko≈°√≠ku */

/* √öprava otev≈ôen√©ho vyhled√°v√°n√≠ */
function handleSearchResults() {
  const lang = document.documentElement.lang || "other";
  const dict = translations[lang] || translations.other;

  const container = document.querySelector(".search-whisperer-documents");
  if (!container) return;

  // Vyƒçistit p≈ôedchoz√≠ wrappery (pro jistotu p≈ôi opakovan√©m spu≈°tƒõn√≠ eventu)
  container
    .querySelectorAll(
      ".search-whisperer-category-wrapper, .search-whisperer-other-wrapper, .search-whisperer-title"
    )
    .forEach((el) => el.remove());

  // Vybereme kategorie a ostatn√≠ v√Ωsledky
  const categories = Array.from(
    container.querySelectorAll(".search-whisperer-category")
  );
  const others = Array.from(
    container.querySelectorAll(
      ".search-whisperer-document:not(.search-whisperer-category)"
    )
  );

  // Pokud jsou kategorie
  if (categories.length) {
    const wrapper = document.createElement("div");
    wrapper.className = "search-whisperer-category-wrapper";

    const title = document.createElement("div");
    title.className = "search-whisperer-title";
    title.textContent = dict.search.categories;

    wrapper.appendChild(title);
    categories.forEach((cat) => wrapper.appendChild(cat));

    container.prepend(wrapper);
  }

  // Pokud jsou ostatn√≠ v√Ωsledky
  if (others.length) {
    const wrapper = document.createElement("div");
    wrapper.className = "search-whisperer-other-wrapper";

    const title = document.createElement("div");
    title.className = "search-whisperer-title";
    title.textContent = dict.search.others;

    wrapper.appendChild(title);
    others.forEach((o) => wrapper.appendChild(o));

    container.appendChild(wrapper);
  }

  // Pokud je v .search-whisperer blok s produkty, p≈ôesuneme za nƒõj documents
  const whisperer = document.querySelector(".search-whisperer");
  const products = whisperer
    ? whisperer.querySelector(".search-whisperer-products")
    : null;
  if (whisperer && products) {
    products.insertAdjacentElement("afterend", container);
  }
}

// Spust√≠ se po Shoptet eventu
document.addEventListener("ShoptetDOMSearchResultsLoaded", handleSearchResults);
/* √öprava otev≈ôen√©ho vyhled√°v√°n√≠ */

/* Skryt√≠ kontakt≈Ø v navigaci, pokud jsou na 2 ≈ô√°dky */
function toggleContacts() {
  const bar = document.querySelector(".top-navigation-bar");
  const contacts = document.querySelector(".top-navigation-contacts");
  if (!bar || !contacts) return;

  const barHeight = bar.offsetHeight;
  const contactsHeight = contacts.offsetHeight;

  if (contactsHeight <= 40) {
    // vejdou se ‚Üí uk√°zat
    bar.classList.add("show-contacts");
  } else {
    // nevejdou ‚Üí skr√Ωt
    bar.classList.remove("show-contacts");
  }

  updateTopNavigationOffset?.();
}

document.addEventListener("DOMContentLoaded", () => {
  const ready =
    document.fonts && document.fonts.ready
      ? document.fonts.ready
      : Promise.resolve();

  ready.then(() => {
    requestAnimationFrame(() => {
      toggleContacts();
      window.addEventListener("resize", toggleContacts);
    });
  });
});
/* Skryt√≠ kontakt≈Ø v navigaci, pokud jsou na 2 ≈ô√°dky */

/* Nastaven√≠ sticky velikosti pro .top-navigation-bar */
function updateTopNavigationOffset() {
  const navBar = document.querySelector(".top-navigation-bar");
  const userAction = document.querySelector(".user-action");
  const loginWidget = document.querySelector(".login-widget");
  if (!navBar) return;

  const navHeight = navBar.offsetHeight;
  navBar.style.top = `-${navHeight}px`;

  if (userAction) {
    // sticky pozice
    userAction.style.top = `-${navHeight}px`;
    loginWidget.style.top = `${navHeight + 68}px`;

    // doplnƒõn√≠ margin≈Ø
    userAction.style.marginBottom = `${navHeight}px`;

    // Funkce pro kontrolu, zda je userAction nƒõkde mezi p≈ôedchoz√≠mi siblings
    function hasUserActionSibling(element, targetClass) {
      let prev = element.previousElementSibling;
      while (prev) {
        if (prev.classList.contains(targetClass)) return true;
        // pokud naraz√≠me na nƒõco jin√©ho ne≈æ admin-bar, p≈ôeru≈°ujeme
        if (!prev.classList.contains("admin-bar")) break;
        prev = prev.previousElementSibling;
      }
      return false;
    }

    // Pou≈æit√≠
    if (hasUserActionSibling(navBar, "user-action")) {
      navBar.style.marginTop = `-${navHeight}px`;
    }
  }

  // p≈ôid√°n√≠ classy po √∫pravƒõ top
  navBar.classList.add("top-loaded");
}

document.addEventListener("DOMContentLoaded", () => {
  updateTopNavigationOffset();
});

window.addEventListener("resize", () => {
  updateTopNavigationOffset();
});
/* Nastaven√≠ sticky velikosti pro .top-navigation-bar */

/* P≈ôidat "V√≠ce" p≈ôed .top-naviagion-bar hamburger */
document.addEventListener("DOMContentLoaded", function () {
  const span = document.querySelector("#header .menu-helper > span");
  const target = document.querySelector(
    ".top-navigation-bar .container .top-navigation-menu .top-navigation-menu-trigger"
  );

  if (span && target) {
    const clonedSpan = span.cloneNode(true);
    target.prepend(clonedSpan);
  }
});
/* P≈ôidat "V√≠ce" p≈ôed .top-naviagion-bar hamburger */

/* Otev√≠r√°n√≠ podkategori√≠ v hamburger menu */
window.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".menu-helper .submenu-arrow").forEach((arrow) => {
    arrow.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();
      e.stopImmediatePropagation();

      const parentLi = arrow.closest("li");
      if (!parentLi) return;

      document
        .querySelectorAll(".menu-helper li.exp-custom")
        .forEach((item) => {
          if (item !== parentLi) item.classList.remove("exp-custom");
        });

      parentLi.classList.toggle("exp-custom");
    });
  });
});
/* Otev√≠r√°n√≠ podkategori√≠ v hamburger menu */

/* Na mobilu udƒõlat custom submenu-visible-custom classu na otev√≠r√°n√≠ submenu v navigaci */
document.addEventListener("DOMContentLoaded", () => {
  const nav = document.querySelector("body #header #navigation");

  if (!nav) return;

  nav.addEventListener("click", (e) => {
    const arrow = e.target.closest(".menu-level-1 > li > a .submenu-arrow");
    if (!arrow) return;

    // Mal√Ω timeout, aby se t≈ô√≠da .exp po kliknut√≠ stihla p≈ôidat/odebrat
    // setTimeout(() => {
    const menuItems = nav.querySelectorAll(".menu-level-1 > li");
    const hasExp = Array.from(menuItems).some((li) =>
      li.classList.contains("exp")
    );

    if (!hasExp) {
      document.body.classList.add("submenu-visible-custom");
    } else {
      document.body.classList.remove("submenu-visible-custom");
    }
    // }, 50); // 0ms staƒç√≠, spust√≠ se po vykon√°n√≠ ostatn√≠ch click handler≈Ø
  });
});
/* Na mobilu udƒõlat custom submenu-visible-custom classu na otev√≠r√°n√≠ submenu v navigaci */

/* Na mobilu zru≈°√≠ search po kliknut√≠ mimo */
document.addEventListener("click", function (e) {
  const body = document.body;

  // podm√≠nka: jen kdy≈æ je na <body> classa "mobile" + "search-window-visible"
  if (
    body.classList.contains("mobile") &&
    body.classList.contains("search-window-visible")
  ) {
    // kontrola, jestli kliknut√≠ nebylo uvnit≈ô .search
    if (!e.target.closest(".search")) {
      body.classList.remove("search-window-visible");
    }
  }
});
/* Na mobilu zru≈°√≠ search po kliknut√≠ mimo */

/* Scroll na # poƒç√≠t√° s navigac√≠ */
// Plynul√Ω scroll s rezervou (funguje i pro display:none)
$(document).on("click", 'a[href^="#"]:not(.shp-tabs-row a)', function (e) {
  const targetSelector = $(this).attr("href");
  const $target = $(targetSelector);
  if ($target.length === 0) return;

  e.preventDefault();

  const isMobile = window.innerWidth <= 767;
  const offset = isMobile ? 60 : 124;
  let targetTop;

  if ($target.is(":visible")) {
    // Pokud je prvek viditeln√Ω, spoƒç√≠tej rovnou
    targetTop = $target.offset().top - offset;
  } else {
    // Pokud je display:none, doƒçasnƒõ ho zobraz
    const originalStyles = {
      display: $target.css("display"),
      visibility: $target.css("visibility"),
      position: $target.css("position"),
    };

    // Nastav doƒçasnƒõ tak, aby ≈°el zmƒõ≈ôit
    $target.css({
      display: "block",
      visibility: "hidden",
      position: "absolute",
    });

    targetTop = $target.offset().top - offset;

    // Vra≈• p≈Øvodn√≠ styl
    $target.css(originalStyles);
  }

  $("html, body").animate({ scrollTop: targetTop }, 300);
});
/* Scroll na # poƒç√≠t√° s navigac√≠ */

/* Carousel swipe */
document.querySelectorAll(".carousel").forEach((carousel) => {
  let xStart = null;

  carousel.addEventListener("touchstart", (e) => {
    xStart = e.touches[0].pageX;

    function onTouchMove(e) {
      const xMove = e.touches[0].pageX;
      const diff = xStart - xMove;
      const sensitivity = 5;

      if (diff > sensitivity) {
        carousel.querySelector(".right")?.click();
      } else if (diff < -sensitivity) {
        carousel.querySelector(".left")?.click();
      }

      carousel.removeEventListener("touchmove", onTouchMove);
    }

    carousel.addEventListener("touchmove", onTouchMove, { once: true });

    carousel.addEventListener(
      "touchend",
      () => {
        carousel.removeEventListener("touchmove", onTouchMove);
      },
      { once: true }
    );
  });
});
/* Carousel swipe */

/* Carousel indicator */
document.addEventListener("DOMContentLoaded", () => {
  const carousel = document.querySelector(".in-index #carousel");
  if (!carousel) return;

  const carouselInner = carousel.querySelector(".carousel-inner");
  const items = carouselInner.querySelectorAll(".item");

  // Pokud je jen jeden item, indik√°tory netvo≈ô√≠me
  if (items.length <= 1) return;

  const indicators = document.createElement("ol");
  indicators.className = "carousel-indicators";
  carousel.insertBefore(indicators, carouselInner);

  items.forEach((item, index) => {
    const li = document.createElement("li");
    li.setAttribute("data-target", "#carousel");
    li.setAttribute("data-slide-to", index);
    if (index === 0) li.classList.add("active");
    indicators.appendChild(li);
  });
});
/* Carousel indicator */

/* Velikost banner≈Ø na z√°kladƒõ textu a obr√°zku */
function adjustBannerImages() {
  const configs = [
    {
      container: ".banner-wrapper",
      text: ".extended-banner-texts",
      img: "img",
    },
    { container: ".item", text: ".extended-banner-texts", img: "img" },
    { container: ".footer-banner", text: ".extended-banner-texts", img: "img" },
    {
      container: ".banner-category",
      text: ".extended-banner-texts",
      img: "img",
    },
  ];

  let foundSomething = false;

  configs.forEach(({ container, text, img }) => {
    document.querySelectorAll(container).forEach((wrapper, i) => {
      const textEl = wrapper.querySelector(text);
      const imgEl = wrapper.querySelector(img);

      if (textEl && imgEl) {
        const rect = textEl.getBoundingClientRect();
        const computedStyle = window.getComputedStyle(textEl);

        // pou≈æijeme nejvƒõt≈°√≠ z hodnot
        const contentHeight = Math.max(
          rect.height,
          textEl.offsetHeight,
          textEl.scrollHeight
        );

        const totalHeight =
          contentHeight +
          parseFloat(computedStyle.marginTop) +
          parseFloat(computedStyle.marginBottom);

        // Nikdy nesni≈æuj min-height ‚Üí pou≈æij max z aktu√°ln√≠ a nov√©
        const prev = parseFloat(imgEl.style.minHeight) || 0;
        const newHeight = Math.max(prev, totalHeight);

        imgEl.style.minHeight = newHeight + "px";
        foundSomething = true;
      }
    });
  });

  return foundSomething;
}
/* Velikost banner≈Ø na z√°kladƒõ textu a obr√°zku */

/* Funkce na √∫pravu bannerov√Ωch text≈Ø */
function processBannerTexts() {
  $(".extended-banner-texts").each(function () {
    const $banner = $(this);
    const $title = $banner.find(".extended-banner-text");
    let text = $title.text();
    const originalText = text; // pro kontrolu na "≈æ√°dn√Ω match"

    // udƒõl√°me case-insensitive porovn√°n√≠
    const lowerText = text.toLowerCase();

    if (lowerText.includes("blacktext")) {
      $banner.addClass("is-black");
      text = text.replace(/blacktext/gi, "").trim(); // sma≈æe v√Ωskyt bez ohledu na velikost p√≠smen
      $title.text(text);
    } else if (lowerText.includes("whitetext")) {
      $banner.addClass("is-white");
      text = text.replace(/whitetext/gi, "").trim();
      $title.text(text);
    } else {
      // pokud tam nebyl ≈æ√°dn√Ω z tag≈Ø
      $banner.addClass("has-background");
      $title.text(originalText.trim());
    }
  });
}
/* Funkce na √∫pravu bannerov√Ωch text≈Ø */

/* Top categories */
document.addEventListener("DOMContentLoaded", () => {
  const isIndex = document.body.classList.contains("type-index");
  const isCategory = document.body.classList.contains("type-category");

  if (!isIndex && !isCategory) return;

  const isMobile = document.body.classList.contains("mobile");
  const isSimplifiedLayout = !document.querySelector(".before-carousel");

  /* -----------------------------
     üè† LOGIKA PRO HOMEPAGE (type-index)
  ------------------------------ */
  if (isIndex) {
    const bannersRow = document.querySelector(
      isMobile || isSimplifiedLayout
        ? "#content > .row.banners-row"
        : ".before-carousel .row.banners-row"
    );
    if (!bannersRow) return;

    // üö© Nov√° logika pro #carousel
    const carousel = document.querySelector("#carousel");
    if (!carousel) {
      bannersRow.classList.add("no-carousel");
      const wideCarousel = bannersRow.querySelector(".wide-carousel");
      if (wideCarousel) wideCarousel.remove();
    }

    // --- NOV√â TOP CATEGORIES ---
    if (
      typeof topCategories !== "undefined" &&
      Array.isArray(topCategories) &&
      topCategories.length
    ) {
      const topCatsData = getTopCategoriesData(topCategories);

      if (topCatsData.length) {
        const topCategoriesHTML = topCatsData
          .map(
            (cat) => `
            <a href="${cat.href}" class="top-category-item">
              <img src="${cat.image}" alt="${cat.name}" />
              <p>${cat.name}</p>
            </a>
          `
          )
          .join("");

        if (
          topCategoriesHTML &&
          !bannersRow.querySelector(".top-categories-custom")
        ) {
          bannersRow.insertAdjacentHTML(
            "afterbegin",
            `<div class="top-categories-custom">
              <h4>Top kategorie</h4>
              <div class="top-categories-wrapper">
                ${topCategoriesHTML}
              </div>
            </div>`
          );
        }
      }
    }

    // --- P≈ÆVODN√ç LOGIKA PRO PRAV√â SLUPCE ---
    const col8 = bannersRow.querySelector(".col-sm-8");
    const col4 = bannersRow.querySelector(".col-sm-4");
    const wideCarousel = bannersRow.querySelector(".wide-carousel");
    const nextToCarousel = bannersRow.querySelector(
      ".next-to-carousel-banners"
    );
    const wideCarouselHasContent = wideCarousel?.querySelector(
      ".carousel-inner .item"
    );

    if (
      (col8 && col4) ||
      (wideCarousel && nextToCarousel && wideCarouselHasContent) ||
      (wideCarousel && wideCarouselHasContent)
    ) {
      const wrapper = document.createElement("div");
      wrapper.className = "right-columns-wrapper";

      if (col8 && col4) {
        wrapper.appendChild(col8);
        wrapper.appendChild(col4);
      } else if (wideCarousel && nextToCarousel && wideCarouselHasContent) {
        wrapper.appendChild(wideCarousel);
        wrapper.appendChild(nextToCarousel);
      } else if (wideCarousel && wideCarouselHasContent) {
        wrapper.appendChild(wideCarousel);
      }

      bannersRow.appendChild(wrapper);
    }

    /* Kontrola naƒç√≠t√°n√≠ obr√°zk≈Ø */
    const bannersInCritical =
      $("#carousel .extended-banner-texts").length ||
      $(".next-to-carousel-banners .extended-banner-texts").length;

    function finalizeLoadedState() {
      requestAnimationFrame(() => {
        bannersRow.classList.add("loaded-state");
      });
    }

    function imagesLoaded(container, callback) {
      const images = Array.from(container.querySelectorAll("img")).filter(
        (img) => {
          const hasSrc = img.currentSrc || img.src;
          const rect = img.getBoundingClientRect();
          const isVisible = rect.top < window.innerHeight && rect.bottom > 0;
          return hasSrc && isVisible;
        }
      );

      let loaded = 0;
      if (images.length === 0) return callback();

      images.forEach((img) => {
        if (img.complete) {
          loaded++;
          if (loaded === images.length) callback();
        } else {
          img.addEventListener("load", check);
          img.addEventListener("error", check);
        }
      });

      function check() {
        loaded++;
        if (loaded === images.length) callback();
      }
    }

    if (bannersInCritical) {
      imagesLoaded(bannersRow, () => {
        processBannerTexts();
        requestAnimationFrame(() => adjustBannerImages?.());
        setTimeout(() => adjustBannerImages?.(), 600);
        finalizeLoadedState();
      });
    } else {
      imagesLoaded(bannersRow, () => finalizeLoadedState());
    }
  }

  /* -----------------------------
     üß© LOGIKA PRO CATEGORY (type-category)
  ------------------------------ */
  if (isCategory) {
    const bannerCategory = document.querySelector(".banner-category");
    if (!bannerCategory) return;

    const hasBanners = $(".banner-category .extended-banner-texts").length;

    if (hasBanners) {
      function imagesLoaded(container, callback) {
        const images = container.querySelectorAll("img");
        let loaded = 0;
        if (images.length === 0) return callback();
        images.forEach((img) => {
          if (img.complete) {
            loaded++;
            if (loaded === images.length) callback();
          } else {
            img.addEventListener("load", check);
            img.addEventListener("error", check);
          }
        });
        function check() {
          loaded++;
          if (loaded === images.length) callback();
        }
      }

      imagesLoaded(bannerCategory, () => {
        processBannerTexts();
        requestAnimationFrame(() => adjustBannerImages?.());
        setTimeout(() => adjustBannerImages?.(), 600);
      });
    }
  }
});

/* P≈ôesunout availability pod cenu */
function moveAvailabilityToPrices() {
  document.querySelectorAll(".products-block .product").forEach((product) => {
    const availability = product.querySelector(".availability");
    const prices = product.querySelector(".prices");

    // P≈ôesun availability do prices
    if (availability && prices && !prices.contains(availability)) {
      prices.appendChild(availability);
    }

    // Pokud existuje flag-discount, p≈ôesu≈à price-standard do price-final a price-save zabal do z√°vorek
    if (product.querySelector(".flag-discount")) {
      const priceStandard = product.querySelector(".price-standard");
      const priceFinal = product.querySelector(".price-final");

      if (priceFinal) {
        // P≈ôesu≈à price-standard dovnit≈ô price-final
        if (priceStandard && !priceFinal.contains(priceStandard)) {
          priceFinal.prepend(priceStandard);
        }
      }
    }
  });
}

// Spus≈• p≈ôi naƒçten√≠ str√°nky
moveAvailabilityToPrices();

// Spus≈• i p≈ôi vlastn√≠ ud√°losti Shoptet (nap≈ô. po ajax filtrov√°n√≠)
document.addEventListener("ShoptetDOMContentLoaded", moveAvailabilityToPrices);
/* P≈ôesunout availability pod cenu */

// /* Product quantity */
// function productsQuantity() {
//   document.querySelectorAll(".products-block .product").forEach((product) => {
//     const productTools = product.querySelector(".p-tools");
//     const hasCartButton = product.querySelector(".btn-cart") !== null;
//     const productForm = product.querySelector("form.pr-action");

//     // Odstranit v≈°echny p≈ôedchoz√≠ amount inputy ve .p-tools form
//     document
//       .querySelectorAll('.p-tools form > input[name="amount"]')
//       .forEach((input) => {
//         input.remove();
//       });

//     if (productForm) {
//       // Pokud formul√°≈ô nem√° .quantity a je tam tlaƒç√≠tko do ko≈°√≠ku
//       if (!productForm.querySelector(".quantity") && hasCartButton) {
//         const quantityHTML = `
//           <span class="quantity">
//             <input type="text" value="1" name="amount" class="amount" data-min="1" data-max="1000">
//             <span class="increase"></span><span class="decrease"></span>
//           </span>
//         `;
//         productForm.insertAdjacentHTML("afterbegin", quantityHTML);
//       }
//     } else {
//       // Produkt bez variant ‚Äì ale bez <form>
//       if (!productTools.querySelector(".quantity") && hasCartButton) {
//         const quantityHTML = `
//           <span class="quantity" title="Produkt obsahuje varianty">
//             <input type="text" disabled value="1" name="amount" class="amount" data-min="1" data-max="1000">
//             <span class="increase"></span><span class="decrease"></span>
//           </span>
//         `;
//         productTools.insertAdjacentHTML("afterbegin", quantityHTML);

//         const quantity = productTools.querySelector(".quantity");
//         quantity.addEventListener("click", (e) => {
//           e.preventDefault();
//           e.stopPropagation();
//         });
//       }
//     }
//   });
// }

// // Spustit okam≈æitƒõ
// productsQuantity();

// // Opakovat p≈ôi eventu ShoptetDOMContentLoaded
// document.addEventListener("ShoptetDOMContentLoaded", productsQuantity);
// /* Product quantity */

// /* Sorting - Zobrazen√≠ vybran√©ho labelu jako placeholder */
// function updateOrderPlaceholder() {
//   const fieldset = document.querySelector(
//     "#category-header .listSorting__controls"
//   );
//   if (!fieldset) return;

//   // Najdi nebo vytvo≈ô placeholder element
//   let placeholder = fieldset.querySelector(".order-placeholder");
//   if (!placeholder) {
//     placeholder = document.createElement("div");
//     placeholder.className = "order-placeholder";
//     fieldset.prepend(placeholder);
//   }

//   // Odeber p≈ôedchoz√≠ classu selected ze v≈°ech label≈Ø
//   fieldset.querySelectorAll("label.selected").forEach((label) => {
//     label.classList.remove("selected");
//   });

//   // Odeber p≈ôedchoz√≠ classu last ze v≈°ech label≈Ø
//   fieldset.querySelectorAll("label.last").forEach((label) => {
//     label.classList.remove("last");
//   });

//   // Najdi oznaƒçen√Ω input nebo fallback na prvn√≠ mo≈ænost
//   let checkedInput = fieldset.querySelector('input[type="radio"]:checked');
//   if (!checkedInput) {
//     checkedInput = fieldset.querySelector('input[type="radio"]');
//     if (checkedInput) {
//       checkedInput.checked = true;
//     }
//   }

//   if (!checkedInput) return; // Pokud tam ≈æ√°dn√Ω input nen√≠

//   const label = fieldset.querySelector(`label[for="${checkedInput.id}"]`);
//   if (!label) return;

//   // Nastav text placeholderu podle obsahu labelu
//   placeholder.textContent = label.textContent;

//   // P≈ôidej classu selected na dan√Ω label, aby se mohl skr√Ωt ve SCSS
//   label.classList.add("selected");

//   // Najdi posledn√≠ label bez class selected a p≈ôidej mu class last
//   const labels = Array.from(fieldset.querySelectorAll("label"));
//   for (let i = labels.length - 1; i >= 0; i--) {
//     if (!labels[i].classList.contains("selected")) {
//       labels[i].classList.add("last");
//       break;
//     }
//   }
// }

// // Spustit p≈ôi naƒçten√≠ str√°nky
// updateOrderPlaceholder();

// // Spustit i po ajaxov√©m naƒçten√≠ (Shoptet eventy)
// document.addEventListener("ShoptetDOMContentLoaded", updateOrderPlaceholder);
// document.addEventListener("ShoptetPageSortingChanged", updateOrderPlaceholder);
// /* Sorting - Vlo≈æen√≠ checked labelu na prvn√≠ pozici */

/* Sorting - Zobrazen√≠ vybran√©ho labelu jako placeholder */
function scrollToProductsListHeading() {
  const $target = $("#productsListHeading");
  if ($target.length === 0) return;

  const isMobile = window.innerWidth <= 767;
  const offset = isMobile ? 60 : 124;
  let targetTop;

  if ($target.is(":visible")) {
    targetTop = $target.offset().top - offset;
  } else {
    const originalStyles = {
      display: $target.css("display"),
      visibility: $target.css("visibility"),
      position: $target.css("position"),
    };
    $target.css({
      display: "block",
      visibility: "hidden",
      position: "absolute",
    });
    targetTop = $target.offset().top - offset;
    $target.css(originalStyles);
  }

  $("html, body").animate({ scrollTop: targetTop }, 300);
}

function updateOrderPlaceholder() {
  const current = document.querySelector(".listSorting__control--current");
  const controls = document.querySelector(".listSorting__controls");

  if (current && controls) {
    const liParent = current.closest("li");
    if (liParent) {
      controls.insertBefore(liParent, controls.firstChild);
    }
  }
}

// Spustit p≈ôi naƒçten√≠ str√°nky
updateOrderPlaceholder();

// Spustit i po ajaxov√©m naƒçten√≠ (Shoptet eventy)
document.addEventListener("ShoptetDOMContentLoaded", updateOrderPlaceholder);
document.addEventListener("ShoptetPageSortingChanged", () => {
  updateOrderPlaceholder();
  scrollToProductsListHeading();
});
/* Sorting - Zobrazen√≠ vybran√©ho labelu jako placeholder */

/* P≈ôesunut√≠ tlaƒç√≠tka pro otev≈ôen√≠ filtr≈Ø */
function cloneUnveilButtonIfNoSidebar() {
  const sidebar = document.querySelector(".sidebar");
  const categoryHeader = document.querySelector("#category-header");

  // Zkontroluj, jestli u≈æ jsme tlaƒç√≠tko do #category-header nep≈ôidali
  if (
    !categoryHeader ||
    categoryHeader.querySelector(".filters-unveil-button-wrapper")
  )
    return;

  // Najdi tlaƒç√≠tko znovu v≈ædy po reloadu obsahu
  const content = document.querySelector("#content");
  const originalButton = content?.querySelector(
    ".filters-unveil-button-wrapper"
  );

  if (!sidebar && originalButton) {
    const clone = originalButton.cloneNode(true);
    categoryHeader.appendChild(clone);
  }
}

// Spustit p≈ôi naƒçten√≠ i po ajaxu
document.addEventListener("DOMContentLoaded", cloneUnveilButtonIfNoSidebar);
document.addEventListener(
  "ShoptetDOMContentLoaded",
  cloneUnveilButtonIfNoSidebar
);
/* P≈ôesunut√≠ tlaƒç√≠tka pro otev≈ôen√≠ filtr≈Ø */

/* Opraven√≠ automatick√©ho zav√≠r√°n√≠ filtr≈Ø */
function syncFiltersState() {
  if (!document.body.classList.contains("type-category")) return;

  const filters = document.querySelector("#filters");
  if (!filters) return;

  if (filters.classList.contains("visible")) {
    document.body.classList.add("filters-visible");
  } else {
    document.body.classList.remove("filters-visible");
  }
}

document.addEventListener("DOMContentLoaded", syncFiltersState);
document.addEventListener("ShoptetDOMContentLoaded", syncFiltersState);
/* Opraven√≠ automatick√©ho zav√≠r√°n√≠ filtr≈Ø */

/* Otev√≠r√°n√≠ a zav√≠r√°n√≠ filtr≈Ø na mobilu */
// Funkce, kter√° zajist√≠ existenci .close ve #filters
// a p≈ô√≠padnƒõ p≈ôid√° .filter-open-onl na <body>
function ensureCloseButton() {
  const filters = document.querySelector("#filters");
  const toggleWrapper = document.querySelector(
    ".filters-unveil-button-wrapper"
  );

  if (filters) {
    // p≈ôid√°n√≠ close tlaƒç√≠tka, pokud nen√≠
    if (!filters.querySelector(".close")) {
      const closeElement = document.createElement("div");
      closeElement.className = "close";
      filters.prepend(closeElement);
    }

    // pokud chyb√≠ .filters-unveil-button-wrapper ‚Üí p≈ôidat class na body
    if (!toggleWrapper) {
      document.body.classList.add("filter-open-only");
    }
  }
}

// 1) P≈ôid√°n√≠ .close po naƒçten√≠ str√°nky
document.addEventListener("DOMContentLoaded", ensureCloseButton);

// 2) P≈ôid√°n√≠ .close po Shoptet DOM rekonstrukci
document.addEventListener("ShoptetDOMContentLoaded", ensureCloseButton);

// 3) Hlavn√≠ click handler
document.addEventListener("click", function (e) {
  const isMobile = window.innerWidth < 768;
  const body = document.body;
  const filters = document.querySelector("#filters");
  const toggleBtn = document.querySelector(
    ".filters-unveil-button-wrapper .btn"
  );
  const closeBtn = filters ? filters.querySelector(".close") : null;

  if (!isMobile) return;

  // Klik na open/close button ‚Üí ignorovat (nechceme double klik)
  if (toggleBtn && toggleBtn.contains(e.target)) {
    return;
  }

  // Klik na .close ‚Üí zav≈ô√≠t filtr
  if (closeBtn && closeBtn.contains(e.target)) {
    if (toggleBtn) toggleBtn.click();
    return;
  }

  // Pokud nen√≠ filtr otev≈ôen ‚Üí nic
  if (!body.classList.contains("filters-visible")) return;

  // Klik mimo filtry ‚Üí zav≈ô√≠t
  const clickedOutsideFilters = !filters.contains(e.target);
  if (clickedOutsideFilters) {
    if (toggleBtn) toggleBtn.click();
  }
});
/* Otev√≠r√°n√≠ a zav√≠r√°n√≠ filtr≈Ø na mobilu */

/* Spr√°vnƒõ zarovnat prvky v .product-top v detailu produktu */
function modifyProductTop() {
  if (!document.body.classList.contains("type-detail")) return;

  const productTop = document.querySelector(".product-top");
  const infoWrapper = productTop?.querySelector(".p-info-wrapper");
  const header = document.querySelector(".p-detail-inner-header");
  const detailInfo = productTop?.querySelector(".p-detail-info");

  // nov√© selektory
  const shortDescription = productTop?.querySelector(".p-short-description");
  const finalPriceWrapper = productTop?.querySelector(".p-final-price-wrapper");
  const cardDescr = productTop?.querySelector(
    'p[data-testid="productCardDescr"]'
  );

  if (productTop && infoWrapper && header) {
    // Existuj√≠c√≠ p≈ôesuny
    infoWrapper.prepend(header);

    if (detailInfo) {
      header.insertAdjacentElement("afterend", detailInfo);
    }

    // P≈ôesun .p-short-description za .p-final-price-wrapper
    if (shortDescription && finalPriceWrapper) {
      finalPriceWrapper.insertAdjacentElement("beforebegin", shortDescription);
    }

    // P≈ôesun productCardDescr za shortDescription
    if (cardDescr && shortDescription) {
      shortDescription.insertAdjacentElement("afterend", cardDescr);
    }

    productTop.classList.add("loaded-state");
  }
}

document.addEventListener("DOMContentLoaded", modifyProductTop);
document.addEventListener("ShoptetDOMContentLoaded", modifyProductTop);
/* Spr√°vnƒõ zarovnat prvky v .product-top v detailu produktu */

/* Slick produkt≈Ø */
document.addEventListener("DOMContentLoaded", () => {
  // Funkce pro inicializaci slick
  function initProductsSlick(container, isHP = false) {
    const hasSidebar = document.querySelector(".sidebar") !== null;
    const bodyHasColumnsMobile2 =
      document.body.classList.contains("columns-mobile-2");
    const bodyHasColumns3 = document.body.classList.contains("columns-3");

    const configDefault = {
      slidesToShow: 5,
      responsive: [
        { breakpoint: 1440, settings: { slidesToShow: 4 } },
        { breakpoint: 1200, settings: { slidesToShow: 3 } },
        { breakpoint: 992, settings: { slidesToShow: 2 } },
      ],
    };

    const configColumns3 = {
      slidesToShow: 4,
      responsive: [
        { breakpoint: 1440, settings: { slidesToShow: 3 } },
        { breakpoint: 992, settings: { slidesToShow: 2 } },
      ],
    };

    const configWithSidebar = {
      slidesToShow: 3,
      responsive: [{ breakpoint: 1440, settings: { slidesToShow: 2 } }],
    };

    if (!bodyHasColumnsMobile2) {
      const mobileRule = { breakpoint: 480, settings: { slidesToShow: 1 } };
      configDefault.responsive.push(mobileRule);
      configColumns3.responsive.push(mobileRule);
      configWithSidebar.responsive.push(mobileRule);
    }

    let finalConfig;
    if (hasSidebar) finalConfig = configWithSidebar;
    else if (bodyHasColumns3) finalConfig = configColumns3;
    else finalConfig = configDefault;

    $(container).slick({
      slidesToScroll: 1,
      infinite: true,
      arrows: true,
      dots: false,
      ...finalConfig,
    });

    if (isHP) {
      document.body.classList.add("slick-active-custom");
    }
  }

  // ---------------------------------------------------
  // Type-detail
  // ---------------------------------------------------
  if (
    document.body.classList.contains("type-detail") &&
    !document.body.classList.contains("columns-1")
  ) {
    const detailContainer = document.querySelector(".products-related");
    if (detailContainer) initProductsSlick(detailContainer);
  }

  // ---------------------------------------------------
  // Type-index (HP) = v≈°echny .products-block
  // ---------------------------------------------------
  if (
    typeof productsCarouselHP !== "undefined" &&
    productsCarouselHP === true &&
    document.body.classList.contains("type-index")
  ) {
    const hpBlocks = document.querySelectorAll(".products-block");

    hpBlocks.forEach((block) => {
      initProductsSlick(block, true);
    });
  }
});
/* Slick produkt≈Ø */

/* Swipov√°n√≠ produktov√Ωch obr√°zk≈Ø */
document.addEventListener("DOMContentLoaded", () => {
  const mainImgWrapper = document.querySelector(".p-image");
  const thumbnails = Array.from(
    document.querySelectorAll(".p-thumbnails .p-thumbnail")
  );

  if (!mainImgWrapper || thumbnails.length === 0) return;

  let startX = 0;
  let endX = 0;

  const anchor = mainImgWrapper.querySelector("a.p-main-image");
  const mainImg = mainImgWrapper.querySelector("img");

  function getCurrentIndex() {
    return thumbnails.findIndex((t) => t.classList.contains("highlighted"));
  }

  function switchTo(index) {
    if (index < 0 || index >= thumbnails.length) return;

    const thumb = thumbnails[index];
    const bigHref = thumb.getAttribute("href"); // big image
    const origHref = bigHref.replace("/big/", "/orig/"); // Shoptet pattern

    // 1) zmƒõna viditeln√©ho obr√°zku
    mainImg.src = bigHref;

    // 2) zmƒõna odkaz≈Ø Shoptetu
    anchor.setAttribute("href", bigHref);
    anchor.setAttribute("data-href", origHref);

    // 3) zmƒõna highlighted
    thumbnails.forEach((t) => t.classList.remove("highlighted"));
    thumb.classList.add("highlighted");
  }

  // Swipe start
  mainImgWrapper.addEventListener("touchstart", (e) => {
    startX = e.touches[0].clientX;
  });

  // Swipe end
  mainImgWrapper.addEventListener("touchend", (e) => {
    endX = e.changedTouches[0].clientX;
    const diff = endX - startX;

    if (Math.abs(diff) < 40) return;

    const currentIndex = getCurrentIndex();

    if (diff < 0) {
      // vlevo ‚Üí dal≈°√≠
      switchTo(currentIndex + 1);
    } else {
      // vpravo ‚Üí p≈ôedchoz√≠
      switchTo(currentIndex - 1);
    }
  });
});
/* Swipov√°n√≠ produktov√Ωch obr√°zk≈Ø */
